!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("file-input-accessor",["exports","@angular/core","@angular/forms","rxjs","rxjs/operators"],t):t((e=e||self)["file-input-accessor"]={},e.ng.core,e.ng.forms,e.rxjs,e.rxjs.operators)}(this,(function(e,t,r,n,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function o(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(a=(o<3?i(a):o>3?i(t,r,a):i(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a}function a(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function u(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}var s=function(){function e(e,t){this._renderer=e,this._elementRef=t,this.onChange=function(e){},this.onTouched=function(){},this.validator=this.generateAsyncValidator()}var s;return s=e,Object.defineProperty(e.prototype,"allowedExt",{get:function(){return this._allowedExt},set:function(e){"string"==typeof e&&(e+="$"),e instanceof Array&&(e=e.join("|")+"$"),this._allowedExt=e},enumerable:!0,configurable:!0}),e.prototype.writeValue=function(e){this._renderer.setProperty(this._elementRef.nativeElement,"value",null)},e.prototype.registerOnChange=function(e){this.onChange=this.onChangeGenerator(e)},e.prototype.registerOnTouched=function(e){},e.prototype.setDisabledState=function(e){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",e)},e.prototype.validate=function(e){return this.validator(e)},e.prototype.generateAsyncValidator=function(){var e=this;return function(t){var r,o;if(!t.value||!t.value.length||t.disabled)return n.of({});var a={},s=[],l=function(t){if(e.size&&e.size<t.size&&(t.errors.fileSize=!0,a.fileSize=!0),t.isImg&&(e.maxWidth||e.maxHeight||e.minWidth||e.minHeight)&&s.push(t.imgLoadReplay.pipe(i.take(1),i.map((function(r){var n=e.minWidth&&t.imgWidth<e.minWidth,i=e.minHeight&&t.imgHeight<e.minHeight,o=e.maxWidth&&t.imgWidth>e.maxWidth,u=e.maxHeight&&t.imgHeight>e.maxHeight;return n&&(t.errors.minWidth=!0,a.minWidth=!0),i&&(t.errors.minHeight=!0,a.minHeight=!0),o&&(t.errors.maxWidth=!0,a.maxWidth=!0),u&&(t.errors.maxHeight=!0,a.maxHeight=!0),(n||o)&&(t.errors.imageWidth=!0,a.imageWidth=!0),(i||u)&&(t.errors.imageHeight=!0,a.imageHeight=!0),r})))),!e.allowedExt&&!e.allowedTypes)return"continue";var r=e.generateRegExp(e.allowedExt),n=e.generateRegExp(e.allowedTypes);r&&!r.test(t.name)&&(t.errors.fileExt=!0,a.fileExt=!0),n&&!n.test(t.type)&&(t.errors.fileType=!0,a.fileType=!0)};try{for(var f=u(t.value),d=f.next();!d.done;d=f.next()){l(d.value)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}return s.length?n.forkJoin.apply(void 0,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}(s)).pipe(i.map((function(){return a}))):n.of(a)}},e.prototype.onChangeGenerator=function(e){var t=this;return function(r){var n,i,o=[];try{for(var a=u(r),p=a.next();!p.done;p=a.next()){var s=p.value;if(t.withMeta&&FileReader){var l=new FileReader;t.generateFileMeta(s,l)}s.errors={},o.push(s)}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}e(o)}},e.prototype.generateRegExp=function(e){return e?e instanceof RegExp?new RegExp(e):"string"==typeof e?new RegExp(e,"ig"):e instanceof Array?new RegExp("("+e.join("|")+")","ig"):null:null},e.prototype.generateFileMeta=function(e,t){e.type.match(/text.*/)?e.textLoadReplay=this.setText(e,t):e.type.match(/image.*/)&&(e.imgLoadReplay=this.setImage(e,t))},e.prototype.setImage=function(e,t){e.isImg=!0;var r=new Image,o=n.fromEventPattern((function(e){return r.addEventListener("load",e)}),(function(e){return r.removeEventListener("load",e)})).pipe(i.take(1),i.shareReplay()),a=n.fromEventPattern((function(e){return t.addEventListener("load",e)}),(function(e){return t.removeEventListener("load",e)})).pipe(i.take(1),i.shareReplay()),u=new n.ReplaySubject(1);return n.forkJoin(o,a).pipe(i.first()).subscribe(u),o.pipe(i.first()).subscribe((function(){e.imgHeight=r.height,e.imgWidth=r.width})),a.pipe(i.first()).subscribe((function(){e.imgSrc=t.result+"",r.src=t.result+""})),t.readAsDataURL(e),u},e.prototype.setText=function(e,t){var r=n.fromEventPattern((function(e){return t.addEventListener("load",e)}),(function(e){return t.removeEventListener("load",e)})).pipe(i.take(1),i.shareReplay()),o=new n.ReplaySubject(1);return r.subscribe(o),r.pipe(i.first()).subscribe((function(){e.textContent=t.result+""})),t.readAsText(e),o},e.ctorParameters=function(){return[{type:t.Renderer2},{type:t.ElementRef}]},o([t.Input(),a("design:type",Object)],e.prototype,"allowedTypes",void 0),o([t.Input(),a("design:type",Number)],e.prototype,"size",void 0),o([t.Input(),a("design:type",Boolean)],e.prototype,"withMeta",void 0),o([t.Input(),a("design:type",Number)],e.prototype,"maxHeight",void 0),o([t.Input(),a("design:type",Number)],e.prototype,"maxWidth",void 0),o([t.Input(),a("design:type",Number)],e.prototype,"minHeight",void 0),o([t.Input(),a("design:type",Number)],e.prototype,"minWidth",void 0),o([t.Input(),a("design:type",Object),a("design:paramtypes",[Object])],e.prototype,"allowedExt",null),o([t.HostListener("change",["$event.target.files"]),a("design:type",Object)],e.prototype,"onChange",void 0),o([t.HostListener("blur"),a("design:type",Object)],e.prototype,"onTouched",void 0),e=s=o([t.Directive({selector:"input[type=file][formControl],input[type=file][formControlName],input[type=file][ngModel]",providers:[{provide:r.NG_VALUE_ACCESSOR,useExisting:t.forwardRef((function(){return s})),multi:!0},{provide:r.NG_ASYNC_VALIDATORS,useExisting:t.forwardRef((function(){return s})),multi:!0}]}),a("design:paramtypes",[t.Renderer2,t.ElementRef])],e)}(),l=function(){function e(){}return e=o([t.NgModule({declarations:[s],imports:[r.FormsModule,r.ReactiveFormsModule],exports:[s,r.FormsModule,r.ReactiveFormsModule]})],e)}();e.FileInputAccessor=s,e.FileInputAccessorModule=l,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=file-input-accessor.umd.min.js.map